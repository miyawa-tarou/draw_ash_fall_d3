<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="https://unpkg.com/topojson@3"></script>
</head>
<body>
<svg id="map"></svg>

<div>地図：https://github.com/miyawa-tarou/japan_map_json/blob/master/data/topojson/pref.json</div>

<script>
    (function() {

        // SVGの大きさ
        var width = 800;
        var height = 600;

        // 中心座標とスケール
        var projection = d3.geoMercator()
            .center([130.6, 31.6])
            .scale(20000)
            .translate([width / 2, height / 2]);

        // おまじない
        var path = d3.geoPath().projection(projection);

        var svg = d3.select("#map")
            .attr("width", width)
            .attr("height", height);

        d3.json("./map/japan.json").then(function(data) {
            svg.selectAll("path")  // おまじない。というか理解できてない
                .data(topojson.feature(data, data.objects.pref).features)
                .enter() // dataで入れた配列をそれぞれ以下のpathにしていく
                .append("path")
                .attr("d", path) // <path d="">に　path()の返り値を入れていく
                .attr("fill", function(d,i){ return "green";}); // こういうのができるよ的な意味からreturnで返してみる

            // 本当は三角形が良かったが、正三角形は複雑なので円でごまかす
            var coordinate = projection([130.65, 31.6]);

            svg.append('g')
                .append('circle')
                .attr('cx', coordinate[0])
                .attr('cy', coordinate[1])
                .attr('r', 10)
                .attr('stroke', 'black')
                .attr('fill', 'black');

        });
    })();

</script>
</body>
</html>